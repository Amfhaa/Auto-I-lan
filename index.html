<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BAPEN Auto-I'lan</title>
  <link rel="icon" type="image/svg+xml" href="logo_bapen.svg">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* ========== Neo-Brutalism Retro + Islami Accent ========== */
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Poppins', sans-serif;
      background: #f5f3e3; /* Warna latar yang lebih lembut */
      color: #2d2d2d;
      line-height: 1.6;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: #2d2d2d;
      color: #f5f3e3;
      border: 2px solid #2d2d2d;
      border-radius: 8px;
      box-shadow: 4px 4px 0 rgba(0,0,0,0.2);
      margin-bottom: 20px;
      font-family: 'Poppins', sans-serif;
    }

    h1 {
      margin: 20px 0;
      font-size: 2em;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      color: #2d2d2d;
      letter-spacing: -0.5px;
    }

    /* Controls styling */
    .controls {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin: 25px 0;
      padding: 20px;
      background: rgba(255,255,255,0.7);
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    select, button {
      padding: 12px 18px;
      font-size: 1rem;
      border: 2px solid #2d2d2d;
      background: #fff;
      font-family: 'Poppins', sans-serif;
      border-radius: 6px;
      box-shadow: 3px 3px 0 rgba(0,0,0,0.1);
      transition: all 0.2s ease;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }

    select {
      background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNNyAxMGw1IDUgNS01eiIgZmlsbD0iIzJkMmQyZCIvPjwvc3ZnPg==');
      background-repeat: no-repeat;
      background-position: right 10px center;
      padding-right: 40px;
      min-width: 180px;
    }

    button {
      cursor: pointer;
      background: #d0b3ff;
      border: 2px solid #2d2d2d;
      font-weight: 500;
      padding: 12px 24px;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 3px 5px 0 rgba(0,0,0,0.2);
    }

    button:active {
      transform: translateY(1px);
      box-shadow: 1px 2px 0 rgba(0,0,0,0.1);
    }

    button::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.2);
      transform: translate(-50%, -50%) scale(0);
      border-radius: 50%;
      transition: transform 0.3s ease;
    }

    button:active::after {
      transform: translate(-50%, -50%) scale(2);
    }

    .btn-clear {
      background: #ff6b6b;
      color: white;
    }

    /* Prayer Table Styling */
    .prayer-table {
      width: 100%;
      margin: 25px 0;
      border-collapse: separate;
      border-spacing: 0;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
      font-family: 'Poppins', sans-serif;
    }
    
    .prayer-table th, .prayer-table td {
      border: 1px solid rgba(0,0,0,0.1);
      padding: 18px;
      text-align: center;
    }
    
    .prayer-table th {
      background: #d0b3ff;
      font-size: 1.1em;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    
    .prayer-table td {
      background: #fff;
      font-size: 1.2em;
      font-weight: 500;
      transition: background-color 0.3s ease;
    }

    .prayer-table .sunrise {
      background: #ffe4b3;
    }
    
    .prayer-table .active {
      background: #f5f3e3;
      position: relative;
      font-weight: 600;
      color: #2d2d2d;
    }
    
    .prayer-table .active::after {
      content: '';
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 20px;
      background: #2d2d2d;
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .prayer-table .active::before {
      content: '';
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      width: 12px;
      height: 12px;
      background: #fff;
      border-radius: 50%;
      z-index: 1;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }

    /* Audio Player & Status Styling */
    .player-container {
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .player-status {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
      margin-bottom: 15px;
      padding: 12px 15px;
      background: #ffffff; /* Background putih solid */
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      border: 1px solid rgba(0,0,0,0.1);
    }

    .status-left {
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 0;
    }

    .status-right {
      text-align: right;
      flex-shrink: 0;
    }

    .status-icon-wrapper {
      flex: 0 0 auto;
      width: 32px; /* Sedikit lebih besar */
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f5f5f5;
      border-radius: 50%;
      padding: 7px;
      transition: all 0.3s ease;
      border: 1px solid rgba(0,0,0,0.1);
    }

    .status-icon {
      width: 100%;
      height: 100%;
      filter: drop-shadow(0 1px 1px rgba(0,0,0,0.1));
    }

    .status-text {
      font-family: 'Poppins', sans-serif;
      font-size: 0.95em;
      color: #ff0000; /* Merah yang sangat kontras */
      margin-left: 8px;
      font-weight: 600;
      text-shadow: 0 0 1px rgba(0,0,0,0.1);
    }

    .countdown-inline {
      font-size: 0.95em;
      color: #2d2d2d;
      font-weight: 500;
      white-space: nowrap;
    }

    #ilan-countdown {
      color: #666;
      font-size: 0.9em;
      margin-left: auto;
    }

    #player {
      width: 100%;
      height: 50px;
      border-radius: 6px;
      background: #fff;
      border: 1px solid rgba(0,0,0,0.1);
    }

    /* Log Container Styling */
    .log-container {
      position: relative;
      margin: 25px 0;
      border: none;
      background: #fff;
      min-height: 120px;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    #audio-log {
      font-family: 'Poppins', sans-serif;
      font-size: 0.9em;
      min-height: 60px;
      max-height: 250px;
      overflow-y: auto;
      line-height: 1.6;
      padding-right: 10px;
    }

    .log-message {
      padding: 8px 12px;
      margin-bottom: 8px;
      border-radius: 4px;
      background: rgba(0,0,0,0.02);
      border-left: 3px solid #d0b3ff;
    }

    .log-message.success {
      border-left-color: #4CAF50;
      background: rgba(76,175,80,0.05);
    }

    .log-message.error {
      border-left-color: #f44336;
      background: rgba(244,67,54,0.05);
    }

    .log-message.warning {
      border-left-color: #ff9800;
      background: rgba(255,152,0,0.05);
    }

    #audio-log::-webkit-scrollbar {
      width: 8px;
    }

    #audio-log::-webkit-scrollbar-track {
      background: #f5f5f5;
      border-radius: 4px;
    }

    #audio-log::-webkit-scrollbar-thumb {
      background: #d0b3ff;
      border-radius: 4px;
    }

    /* Audio Player Styling */
    #player {
      width: 100%;
      margin: 20px 0;
      border: 2px solid #111;
      box-shadow: 3px 3px 0 #111;
      background: #fff;
    }

    /* Custom Audio Player Controls */
    audio::-webkit-media-controls-panel {
      background: #fff;
      border-radius: 0;
    }

    audio::-webkit-media-controls-current-time-display,
    audio::-webkit-media-controls-time-remaining-display {
      color: #111;
      font-family: 'Poppins', sans-serif;
    }

    audio::-webkit-media-controls-timeline {
      background: #d0b3ff;
      border-radius: 0;
      margin: 0 15px;
    }

    audio::-webkit-media-controls-timeline-container {
      padding: 0;
    }

    /* Marquee Styling */
    .announcement-bar {
      background: #ff6b6b;
      color: white;
      padding: 10px;
      margin: -20px -20px 20px -20px;
      border-bottom: 2px solid #111;
      font-weight: bold;
      box-shadow: 0 2px 0 #111;
      overflow: hidden;
      position: relative;
    }

    .announcement-bar marquee {
      font-size: 1.1em;
      padding: 0 20px;
    }

    .announcement-text {
      display: inline-block;
      padding-right: 100vw; /* Memastikan teks mulai dari kanan layar */
    }

    .announcement-icon {
      font-size: 1.2em;
      margin: 0 10px;
      vertical-align: middle;
    }

    /* Icon styling */
    .icon {
      width: 20px;
      height: 20px;
      display: inline-block;
      vertical-align: middle;
      margin: -2px 8px 0;
      filter: drop-shadow(1px 1px 0 rgba(0,0,0,0.3));
    }

    .icon-lg {
      width: 24px;
      height: 24px;
    }

    .icon-white {
      filter: brightness(0) invert(1) drop-shadow(1px 1px 0 rgba(0,0,0,0.3));
    }

    .clock-container {
      display: flex;
      align-items: center;
      gap: 12px;
      background: rgba(255,255,255,0.1);
      padding: 8px 15px;
      border-radius: 4px;
      border: 1px solid rgba(255,255,255,0.2);
      font-family: 'Poppins', sans-serif;
      font-weight: 500;
    }

    .clock-icon {
      width: 22px;
      height: 22px;
      filter: brightness(0) invert(1) drop-shadow(1px 1px 0 rgba(0,0,0,0.5));
    }

    /* Footer styling */
    .footer {
      position: relative;
      margin-top: 60px;
      padding: 25px;
      background: linear-gradient(135deg, #1a237e 0%, #0d1b3f 100%);
      color: rgba(255,255,255,0.9);
      text-align: center;
      border-radius: 12px;
      box-shadow: 0 -8px 25px rgba(0,0,0,0.1);
      font-family: 'Poppins', sans-serif;
      font-weight: 400;
      letter-spacing: 0.3px;
      overflow: hidden;
    }

    .footer::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, 
        rgba(255,255,255,0) 0%,
        rgba(255,255,255,0.1) 50%,
        rgba(255,255,255,0) 100%);
    }

    .footer-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      position: relative;
      z-index: 1;
    }

    .footer-logo {
      height: 35px;
      width: auto;
      transition: transform 0.3s ease;
    }

    .footer-logo:hover {
      transform: scale(1.05);
    }

    .footer-text {
      font-size: 0.95em;
      opacity: 0.9;
    }

    /* Islamic geometric pattern background */
    .footer::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgdmlld0JveD0iMCAwIDQwIDQwIj48cGF0aCBkPSJNMjAgMEwwIDIwaDIweiIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjAyKSIvPjxwYXRoIGQ9Ik0yMCA0MEw0MCAyMEgyMHoiIGZpbGw9InJnYmEoMjU1LDI1NSwyNTUsMC4wMikiLz48L3N2Zz4=');
      opacity: 0.1;
      z-index: 0;
    }

    @media screen and (max-width: 768px) {
      .footer {
        margin: 40px -20px -20px;
        border-radius: 12px 12px 0 0;
      }

      .footer-content {
        flex-direction: column;
        gap: 12px;
      }

      .footer-logo {
        height: 30px;
      }

      .footer-text {
        font-size: 0.9em;
      }
    }

    #ilan-status {
      font-family: 'Poppins', sans-serif;
      font-size: 0.95em;
      color: #2d2d2d;
      margin-left: 8px;
      font-weight: 500;
    }

    .player-status.playing #ilan-status {
      color: #1a237e;
    }

    .player-status.playing .status-icon-wrapper {
      background: rgba(26,35,126,0.1);
    }

    .player-status.playing .status-icon {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.6; }
      100% { opacity: 1; }
    }

    /* Responsive Styling */
    @media screen and (max-width: 768px) {
      body {
        padding: 10px;
      }

      .top-bar {
        flex-direction: column;
        gap: 10px;
        text-align: center;
        padding: 10px;
      }

      .clock-container {
        width: 100%;
        justify-content: center;
      }

      h1 {
        font-size: 1.4em;
        text-align: center;
      }

      #ilan-status {
        text-align: center;
        margin: -10px 0 15px;
      }

      .controls {
        flex-direction: column;
        gap: 10px;
        margin: 15px 0;
      }

      select, button {
        width: 100%;
        text-align: left;
        justify-content: center;
        font-size: 0.95rem;
        padding: 12px 15px;
        border-radius: 0;
        -webkit-border-radius: 0;
      }

      select {
        background-position: right 15px center;
        background-size: 20px;
        padding-right: 40px;
      }

      button {
        text-align: center;
      }

      .prayer-table {
        font-size: 0.9em;
      }

      .prayer-table th {
        font-size: 0.9em;
        padding: 8px 4px;
      }

      .prayer-table td {
        font-size: 1em;
        padding: 8px 4px;
      }

      .prayer-table .active::after {
        width: 16px;
        height: 16px;
        right: 8px;
      }

      .prayer-table .active::before {
        width: 10px;
        height: 10px;
        right: 11px;
      }

      .announcement-bar {
        margin: -10px -10px 15px -10px;
      }

      .announcement-bar marquee {
        font-size: 0.9em;
      }

      .footer {
        flex-direction: column;
        gap: 10px;
        text-align: center;
        padding: 10px;
      }

      #audio-log {
        font-size: 0.85em;
      }
    }

    @media screen and (max-width: 480px) {
      .prayer-table th {
        font-size: 0.8em;
        padding: 6px 2px;
      }

      .prayer-table td {
        font-size: 0.9em;
        padding: 6px 2px;
      }

      .prayer-table .active::after {
        width: 14px;
        height: 14px;
        right: 6px;
      }

      .prayer-table .active::before {
        width: 8px;
        height: 8px;
        right: 9px;
      }

      h1 {
        font-size: 1.2em;
      }

      #countdown {
        display: block;
        margin-top: 5px;
      }

      .icon-lg {
        width: 20px;
        height: 20px;
      }
    }

    /* Dropdown styling untuk opsi yang belum tersedia */
    .unavailable-option {
      text-decoration-line: line-through;
      color: #999;
      font-style: italic;
    }

    select option[disabled] {
      background: #f5f5f5;
    }

    /* Styling untuk status dan countdown container */
    .status-container {
      margin: -15px 0 30px 44px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    #ilan-status {
      font-style: italic;
      color: #444;
      font-size: 0.95em;
    }

    #ilan-countdown {
      color: #666;
      font-weight: bold;
      font-size: 0.9em;
    }

    @media screen and (max-width: 768px) {
      .status-container {
        margin: -10px 0 25px;
        align-items: center;
        text-align: center;
      }
    }

    .countdown-below {
      margin-top: 12px;
      text-align: right;
      color: #666;
      font-size: 0.9em;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.6; }
      100% { opacity: 1; }
    }

    .playing .status-icon-wrapper {
      background: rgba(45,45,45,0.1);
    }

    .playing .status-icon {
      animation: pulse 2s infinite;
    }

    /* Status styling */
    .status-text {
      font-family: 'Poppins', sans-serif;
      font-size: 0.95em;
      color: #ff0000; /* Merah yang sangat kontras */
      margin-left: 8px;
      font-weight: 600;
      text-shadow: 0 0 1px rgba(0,0,0,0.1);
    }

    .player-status.playing .status-text {
      color: #00b300; /* Hijau yang lebih kontras */
      text-shadow: 0 0 1px rgba(0,255,0,0.2);
    }

    .player-status.bell .status-text {
      color: #ffb700; /* Kuning yang lebih kontras */
      text-shadow: 0 0 2px rgba(255,183,0,0.3);
    }

    /* Status container styling */
    .player-status {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
      margin-bottom: 15px;
      padding: 12px 15px;
      background: #ffffff; /* Background putih solid */
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      border: 1px solid rgba(0,0,0,0.1);
    }

    .player-status.playing {
      background: #f8fff8; /* Background hijau sangat tipis saat playing */
      border: 1px solid rgba(0,179,0,0.2);
    }

    .player-status.bell {
      background: #fffbf0; /* Background kuning sangat tipis saat bell */
      border: 1px solid rgba(255,183,0,0.3);
    }

    /* Icon styling */
    .status-icon-wrapper {
      flex: 0 0 auto;
      width: 32px; /* Sedikit lebih besar */
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f5f5f5;
      border-radius: 50%;
      padding: 7px;
      transition: all 0.3s ease;
      border: 1px solid rgba(0,0,0,0.1);
    }

    .player-status.playing .status-icon-wrapper {
      background: #e8ffe8; /* Background hijau sangat tipis */
      border: 1px solid rgba(0,179,0,0.2);
    }

    .player-status.bell .status-icon-wrapper {
      background: #fff8e6; /* Background kuning sangat tipis */
      border: 1px solid rgba(255,183,0,0.3);
    }

    .status-icon {
      width: 100%;
      height: 100%;
      filter: drop-shadow(0 1px 1px rgba(0,0,0,0.1));
    }

    .icon-speaker,
    .icon-bell {
      display: none; /* Sembunyikan kedua icon secara default */
      width: 100%;
      height: 100%;
    }

    /* Default state - show speaker */
    .icon-speaker {
      display: block; /* Tampilkan speaker sebagai default */
    }

    /* Bell state */
    .player-status.bell .icon-speaker {
      display: none;
    }

    .player-status.bell .icon-bell {
      display: block;
    }

    .player-status.playing .icon-speaker path {
      fill: #00b300;
    }

    .player-status.bell .icon-bell path {
      fill: #ffb700;
    }
  </style>
</head>
<body>

  <div class="announcement-bar">
    <marquee scrollamount="8" behavior="scroll">
      <span class="announcement-text">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTIgMkM2LjQ4IDIgMiA2LjQ4IDIgMTJzNC40OCAxMCAxMCAxMCAxMC00LjQ4IDEwLTEwUzE3LjUyIDIgMTIgMnptMSAxNWgtMnYtMmgydjJ6bTAtNGgtMlY3aDJ2NnoiIGZpbGw9IiNGRkYiLz48L3N2Zz4=" class="icon icon-white" alt="warning">
        AFWAN, WEBSITE MASIH DALAM PENGEMBANGAN
        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTIgMkM2LjQ4IDIgMiA2LjQ4IDIgMTJzNC40OCAxMCAxMCAxMCAxMC00LjQ4IDEwLTEwUzE3LjUyIDIyIDIyIDE3LjUyIDIyIDEyUzE3LjUyIDIgMTEuOTkgMnpNMTIgMjBjLTQuNDIgMC04LTMuNTgtOC04czMuNTgtOCA4LTggOCAzLjU4IDggOC0zLjU4IDgtOCA4eiIgZmlsbD0iIzExMSIvPjxwYXRoIGQ9Ik0xMi41IDdIMTF2NmwzLjI1IDMuMjUuNzUtLjc1TDEyLjUgMTNWN3oiIGZpbGw9IiMxMTEiLz48L3N2Zz4=" class="icon icon-white" alt="warning">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      </span>
    </marquee>
  </div>

  <div class="top-bar">
    <div class="clock-container">
      <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTEuOTkgMkM2LjQ3IDIgMiA2LjQ4IDIgMTJzNC40NyAxMCA5Ljk5IDEwQzE3LjUyIDIyIDIyIDE3LjUyIDIyIDEyUzE3LjUyIDIgMTEuOTkgMnpNMTIgMjBjLTQuNDIgMC04LTMuNTgtOC04czMuNTgtOCA4LTggOCAzLjU4IDggOC0zLjU4IDgtOCA4eiIgZmlsbD0iIzExMSIvPjxwYXRoIGQ9Ik0xMi41IDdIMTF2NmwzLjI1IDMuMjUuNzUtLjc1TDEyLjUgMTZWN3oiIGZpbGw9IiMxMTEiLz48L3N2Zz4=" class="clock-icon" alt="clock">
    <div id="clock">--:--:--</div>
      <div style="color:#fffd99;font-size:0.9em">Depok, Jawa Barat, Indonesia</div>
    </div>
    <div id="date-hijri">Loading...</div>
  </div>

  <h1>
    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTEuOTkgMkM2LjQ3IDIgMiA2LjQ4IDIgMTJzNC40NyAxMCA5Ljk5IDEwQzE3LjUyIDIyIDIyIDE3LjUyIDIyIDEyUzE3LjUyIDIgMTEuOTkgMnpNMTIgMjBjLTQuNDIgMC04LTMuNTgtOC04czMuNTgtOCA4LTggOCAzLjU4IDggOC0zLjU4IDgtOCA4eiIgZmlsbD0iIzExMSIvPjxwYXRoIGQ9Ik0xMi41IDdIMTF2NmwzLjI1IDMuMjUuNzUtLjc1TDEyLjUgMTZWN3oiIGZpbGw9IiMxMTEiLz48L3N2Zz4=" class="icon icon-lg" alt="timer">
    <span id="countdown"></span>
  </h1>

  <div class="controls">
    <select id="member">
      <option value="">Pilih Anggota</option>
      <option value="alfatih">Al-Fatih</option>
      <option value="imam" class="unavailable-option" disabled>Imam</option>
      <option value="udin" class="unavailable-option" disabled>Udin</option>
      <option value="gusti" class="unavailable-option" disabled>Gusti</option>
      <option value="danish" class="unavailable-option" disabled>Danish</option>
      <option value="feyrzan" class="unavailable-option" disabled>Feyrzan</option>
    </select>
    <select id="prayer">
      <option value="">Pilih Waktu Sholat</option>
      <option value="fajr">Subuh</option>
      <option value="dhuhr">Dzuhur</option>
      <option value="asr">Ashar</option>
      <option value="maghrib">Maghrib</option>
      <option value="isha">Isya</option>
    </select>
    <select id="type">
      <option value="">Pilih Jenis I'lan</option>
      <option value="awal">Awal</option>
      <option value="tsani">Tsani</option>
      <option value="akhir">Akhir</option>
    </select>
    <button id="btnPlay">
      <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNOCA2djEybDEwLTZ6IiBmaWxsPSIjMTExIi8+PC9zdmc+" class="icon" alt="play"> Play
    </button>
    <button id="btnPause">
      <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNOCA1djE0aDN2LTE0ek0xMyA1djE0aDN2LTE0eiIgZmlsbD0iIzExMSIvPjwvc3ZnPg==" class="icon" alt="pause"> Pause
    </button>
    <button onclick="clearLog()" class="btn-clear">
      <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNNiAxOWMwIDEuMSAwLjkgMiAyIDJoOGMxLjEgMCAyLTAuOSAyLTJWN0g2djEyek0xOSA0aC0zLjVsLTEtMWgtNWwtMSAxSDV2MmgxNFY0eiIgZmlsbD0iI0ZGRiIvPjwvc3ZnPg==" class="icon icon-white" alt="clear"> Clear Log
    </button>
  </div>

  <div class="log-container">
    <div id="audio-log"></div>
  </div>

  <div class="player-container">
    <div class="player-status">
      <div class="status-left">
        <div class="status-icon-wrapper">
          <svg class="status-icon icon-speaker" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" fill="#2d2d2d"/>
          </svg>
          <svg class="status-icon icon-bell" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z" fill="#2d2d2d"/>
          </svg>
        </div>
        <div class="status-text">tidak memutar suara i'lan</div>
      </div>
      <div class="status-right">
        <div id="ilan-countdown" class="countdown-inline">Menghitung waktu menuju i'lan berikutnya...</div>
      </div>
    </div>
    <audio id="player" controls></audio>
  </div>

  <table class="prayer-table">
    <tr>
      <th>Subuh</th>
      <th>Terbit</th>
      <th>Dzuhur</th>
      <th>Ashar</th>
      <th>Maghrib</th>
      <th>Isya</th>
    </tr>
    <tr>
      <td id="time-fajr">--:--</td>
      <td id="time-sunrise" class="sunrise">--:--</td>
      <td id="time-dhuhr">--:--</td>
      <td id="time-asr">--:--</td>
      <td id="time-maghrib">--:--</td>
      <td id="time-isha">--:--</td>
    </tr>
  </table>

<script>
  // ===== JADWAL SHOLAT & SCHEDULER =====
  let timings = null;
  let prayerTimes = null;
  let tomorrowPrayerTimes = null;
  const player = document.getElementById('player');
  const audioLog = document.getElementById('audio-log');
  const ilanStatus = document.getElementById('ilan-status');

  async function fetchPrayerTimes() {
    try {
      // Coba ambil dari localStorage dulu
      const cachedTimings = localStorage.getItem('prayerTimings');
      const cachedDate = localStorage.getItem('prayerTimingsDate');
      
      // Jika ada cache dan masih hari yang sama, gunakan cache
      if (cachedTimings && cachedDate === new Date().toDateString()) {
        const parsedTimings = JSON.parse(cachedTimings);
        logAudio('✅ Menggunakan jadwal dari cache');
        return parsedTimings;
      }
      
      // Koordinat Depok
      const latitude = -6.4;
      const longitude = 106.8186;
      
      // Get current date
      const now = new Date();
      const timestamp = Math.floor(now.getTime() / 1000);
      
      // Fetch dari API Aladhan
      const response = await fetch(`https://api.aladhan.com/v1/timings/${timestamp}?latitude=${latitude}&longitude=${longitude}&method=11`);
      
      if (!response.ok) {
        throw new Error('Gagal mengambil data dari API');
      }
      
      const data = await response.json();
      
      if (data && data.data && data.data.timings) {
        const timings = {
          Imsak: data.data.timings.Imsak,
          Fajr: data.data.timings.Fajr,
          Sunrise: data.data.timings.Sunrise,
          Dhuhr: data.data.timings.Dhuhr,
          Asr: data.data.timings.Asr,
          Maghrib: data.data.timings.Maghrib,
          Isha: data.data.timings.Isha,
          Midnight: data.data.timings.Midnight
        };
        
        // Simpan ke localStorage
        localStorage.setItem('prayerTimings', JSON.stringify(timings));
        localStorage.setItem('prayerTimingsDate', new Date().toDateString());
        
        logAudio('✅ Berhasil mengambil jadwal dari API Aladhan');
        return timings;
      } else {
        throw new Error('Format data tidak sesuai');
      }
    } catch (err) {
      logAudio(`❌ Error mengambil jadwal: ${err.message}`);
      console.error('Error fetching prayer times:', err);
      
      // Coba ambil dari localStorage meski beda hari sebagai fallback pertama
      const cachedTimings = localStorage.getItem('prayerTimings');
      if (cachedTimings) {
        logAudio('⚠️ Menggunakan jadwal dari cache terakhir');
        return JSON.parse(cachedTimings);
      }
      
      // Fallback ke jadwal statis jika tidak ada cache
      const fallbackTimes = {
        Imsak: '04:31',
        Fajr: '04:41',
        Sunrise: '05:57',
        Dhuhr: '12:01',
        Asr: '15:20',
        Maghrib: '18:00',
        Isha: '19:10',
        Midnight: '00:00'
      };
      
      logAudio('⚠️ Menggunakan jadwal statis sebagai fallback terakhir');
      return fallbackTimes;
    }
  }

  async function initializeScheduler() {
    try {
      if (!timings) {
        logAudio('⏳ Menginisialisasi jadwal dari API Aladhan untuk Depok');
        timings = await fetchPrayerTimes();
        
        if (!timings) {
          throw new Error('Gagal mendapatkan jadwal sholat');
        }

        // Initialize prayer times
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        
        prayerTimes = {
          fajr: convertToDate(timings.Fajr),
          dhuhr: convertToDate(timings.Dhuhr),
          asr: convertToDate(timings.Asr),
          maghrib: convertToDate(timings.Maghrib),
          isha: convertToDate(timings.Isha)
        };

        tomorrowPrayerTimes = {
          fajr: convertToDate(timings.Fajr, tomorrow),
          dhuhr: convertToDate(timings.Dhuhr, tomorrow),
          asr: convertToDate(timings.Asr, tomorrow),
          maghrib: convertToDate(timings.Maghrib, tomorrow),
          isha: convertToDate(timings.Isha, tomorrow)
        };
        
        scheduleAll();
        updatePrayerTable();
        logAudio('✅ Jadwal sholat berhasil dimuat');
      }
      
      updateCountdown();
      updateIlanCountdown();
      
    } catch (err) {
      logAudio(`❌ Error: ${err.message}`);
      console.error('Error initializing scheduler:', err);
    }
  }

  // Jalankan scheduler saat halaman dimuat
  window.addEventListener('load', () => {
    initializeScheduler();
    // Update setiap jam untuk antisipasi pergantian hari
    setInterval(initializeScheduler, 1000*60*60);
  });

  // Update jam setiap detik dengan format yang akurat
  function updateClock() {
    const now = new Date();
    const timeStr = now.toLocaleTimeString('id-ID', { 
      hour12: false,
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    }).replace(/\./g, ':');
    
    const dateStr = now.toLocaleDateString('id-ID', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
    
    document.getElementById('clock').textContent = timeStr;
    document.getElementById('date-hijri').textContent = dateStr;
  }
  setInterval(updateClock, 1000);
  updateClock();

  // ===== CALC NEXT PRAYER & COUNTDOWN =====
  function getNextEvent() {
    if(!timings) return null;
    const now = new Date();
    const events = [];
    
    // Konversi waktu sholat ke timestamp hari ini dan besok
    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1);
    
    const prayerTimes = {
      fajr: convertToDate(timings.Fajr),
      dhuhr: convertToDate(timings.Dhuhr),
      asr: convertToDate(timings.Asr),
      maghrib: convertToDate(timings.Maghrib),
      isha: convertToDate(timings.Isha)
    };

    const tomorrowPrayerTimes = {
      fajr: convertToDate(timings.Fajr, tomorrow),
      dhuhr: convertToDate(timings.Dhuhr, tomorrow),
      asr: convertToDate(timings.Asr, tomorrow),
      maghrib: convertToDate(timings.Maghrib, tomorrow),
      isha: convertToDate(timings.Isha, tomorrow)
    };

    // Fungsi untuk menambahkan waktu i'lan
    function addIlanEvents(prayerTime, prayer) {
      // Hanya tambahkan event adzan
      if (prayerTime > now) {
        events.push({
          prayer,
          when: prayerTime,
          type: 'adzan'
        });
      }
    }

    // Tambahkan semua waktu sholat hari ini
    Object.entries(prayerTimes).forEach(([prayer, time]) => {
      addIlanEvents(time, prayer);
    });

    // Jika tidak ada event tersisa hari ini, tambahkan untuk besok
    if (events.length === 0) {
      Object.entries(tomorrowPrayerTimes).forEach(([prayer, time]) => {
        addIlanEvents(time, prayer);
      });
    }

    // Urutkan berdasarkan waktu terdekat
    events.sort((a,b) => a.when - b.when);
    return events[0] || null;
  }

  function getNextIlan() {
    if(!timings) return null;
    const now = new Date();
    const events = [];
    
    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1);
    
    function addIlanTimes(baseTime, prayer) {
      // Waktu i'lan: 15 menit, 10 menit, dan 5 menit sebelum adzan
      const times = [
        { minutes: 15, type: 'awal' },
        { minutes: 10, type: 'tsani' },
        { minutes: 5, type: 'akhir' }
      ];
      
      times.forEach(({ minutes, type }) => {
        const ilanTime = new Date(baseTime.getTime() - minutes * 60000);
        if (ilanTime > now) {
          events.push({
            prayer,
            when: ilanTime,
            type,
            minutes
          });
        }
      });
    }
    
    // Proses waktu hari ini
    if (prayerTimes) {
      Object.entries(prayerTimes).forEach(([prayer, time]) => {
        addIlanTimes(time, prayer);
      });
    }
    
    // Jika tidak ada event hari ini, proses untuk besok
    if (events.length === 0 && tomorrowPrayerTimes) {
      Object.entries(tomorrowPrayerTimes).forEach(([prayer, time]) => {
        addIlanTimes(time, prayer);
      });
    }
    
    // Urutkan berdasarkan waktu terdekat
    events.sort((a,b) => a.when - b.when);
    return events[0] || null;
  }

  function updateCountdown() {
    const next = getNextEvent();
    if (!next) {
      document.getElementById('countdown').textContent = 'Memuat jadwal...';
      return;
    }
    
    const diff = next.when - new Date();
    const s = Math.floor((diff%60000)/1000);
    const m = Math.floor((diff/60000)%60);
    const h = Math.floor(diff/3600000);
    
    const prayerNames = {
      fajr: 'Subuh',
      dhuhr: 'Dzuhur',
      asr: 'Ashar',
      maghrib: 'Maghrib',
      isha: 'Isya'
    };

    let countdownStr = '';
    if (h > 0) {
      countdownStr = `${h} jam ${m} menit ${s} detik`;
    } else if (m > 0) {
      countdownStr = `${m} menit ${s} detik`;
    } else {
      countdownStr = `${s} detik`;
    }

    document.getElementById('countdown').textContent =
      `${countdownStr} menuju adzan ${prayerNames[next.prayer]}`;
  }

  function updateIlanCountdown() {
    const nextIlan = getNextIlan();
    if (!nextIlan) {
      document.getElementById('ilan-countdown').textContent = 'Menghitung waktu menuju i\'lan berikutnya...';
      return;
    }
    
    const diff = nextIlan.when - new Date();
    const s = Math.floor((diff%60000)/1000);
    const m = Math.floor((diff/60000)%60);
    const h = Math.floor(diff/3600000);
    
    const prayerNames = {
      fajr: 'Subuh',
      dhuhr: 'Dzuhur',
      asr: 'Ashar',
      maghrib: 'Maghrib',
      isha: 'Isya'
    };

    let countdownStr = '';
    if (h > 0) {
      countdownStr = `${h} jam ${m} menit ${s} detik`;
    } else if (m > 0) {
      countdownStr = `${m} menit ${s} detik`;
    } else {
      countdownStr = `${s} detik`;
    }

    document.getElementById('ilan-countdown').textContent =
      `${countdownStr} menuju i'lan ${nextIlan.type} ${prayerNames[nextIlan.prayer]}`;
  }

  // Update countdown setiap 100ms untuk animasi yang lebih halus
  setInterval(() => {
    updateCountdown();
    updateIlanCountdown();
    checkAndPlayScheduledIlan();
  }, 100);

  // Modifikasi scheduleAll untuk menangani i'lan otomatis
  function scheduleAll() {
    try {
      const nextIlan = getNextIlan();
      if (!nextIlan) return;
      
      // clear existing timers
      if (window.nextTimer) clearTimeout(window.nextTimer);
      
      const delay = nextIlan.when - new Date();
      
      // Jangan schedule jika delay negatif (sudah lewat)
      if (delay < 0) return;
      
      window.nextTimer = setTimeout(() => {
        try {
          // Putar audio secara otomatis saat waktunya tiba
          playAudio('alfatih', nextIlan.prayer, nextIlan.type);
          
          // Schedule untuk i'lan berikutnya setelah jeda
          setTimeout(scheduleAll, 2000); // Tunggu 2 detik sebelum schedule berikutnya
        } catch (err) {
          console.error('Error in scheduled playback:', err);
          logAudio(`❌ Error pada pemutaran otomatis: ${err.message}`);
          // Coba schedule ulang setelah error
          setTimeout(scheduleAll, 5000);
        }
      }, delay);

      logAudio(`⏰ Dijadwalkan memutar i'lan ${nextIlan.type} ${nextIlan.prayer} dalam ${Math.floor(delay/60000)} menit ${Math.floor((delay%60000)/1000)} detik`);
    } catch (err) {
      console.error('Error in scheduleAll:', err);
      logAudio(`❌ Error pada penjadwalan: ${err.message}`);
      // Coba schedule ulang setelah error
      setTimeout(scheduleAll, 5000);
    }
  }

  // Panggil scheduleAll setiap kali ada perubahan jadwal
  window.addEventListener('load', () => {
    initializeScheduler();
    // Update setiap 30 menit untuk antisipasi perubahan jadwal
    setInterval(initializeScheduler, 1000*60*30);
  });

  // Tambahkan fungsi untuk mengecek dan memulai pemutaran jika sudah waktunya
  function checkAndPlayScheduledIlan() {
    const nextIlan = getNextIlan();
    if (!nextIlan) return;
    
    const now = new Date();
    const timeDiff = nextIlan.when - now;
    
    // Jika sudah waktunya atau terlambat maksimal 10 detik
    if (timeDiff <= 10000 && timeDiff >= -10000) {
      playAudio('alfatih', nextIlan.prayer, nextIlan.type);
    }
  }

  // Cek setiap 5 detik untuk memastikan tidak ada yang terlewat
  setInterval(checkAndPlayScheduledIlan, 5000);

  // ===== AUDIO & VISUALIZER =====
  function logAudio(msg) {
    const audioLog = document.getElementById('audio-log');
    const logLine = document.createElement('div');
    logLine.className = 'log-message';
    
    // Tambahkan timestamp
    const now = new Date();
    const timestamp = now.toLocaleTimeString('id-ID', {
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    });
    
    // Menentukan tipe pesan
    if (msg.includes('✅')) {
      logLine.className += ' success';
    } else if (msg.includes('❌')) {
      logLine.className += ' error';
    } else if (msg.includes('⚠️')) {
      logLine.className += ' warning';
    }
    
    logLine.innerHTML = `<span style="color:#666;font-size:0.9em">[${timestamp}]</span> ${msg}`;
    audioLog.appendChild(logLine);
    audioLog.scrollTop = audioLog.scrollHeight;
  }

  function updateIlanStatus(member = '', prayer = '', type = '') {
    const statusText = document.querySelector('.status-text');
    const playerStatus = document.querySelector('.player-status');
    
    if (!player.src || player.paused) {
      if (statusText) {
        statusText.textContent = 'tidak memutar suara i\'lan';
        statusText.style.color = '#ff3333'; // Merah yang lebih kontras
      }
      if (playerStatus) {
        playerStatus.classList.remove('playing');
        playerStatus.classList.remove('bell');
      }
      return;
    }

    // Mapping nama yang lebih baik untuk ditampilkan
    const memberNames = {
      alfatih: 'Al-Fatih',
      imam: 'Imam',
      udin: 'Udin',
      gusti: 'Gusti',
      danish: 'Danish',
      feyrzan: 'Feyrzan'
    };

    const prayerNames = {
      fajr: 'Subuh',
      dhuhr: 'Dzuhur',
      asr: 'Ashar',
      maghrib: 'Maghrib',
      isha: 'Isya'
    };

    const typeNames = {
      awal: 'Awal',
      tsani: 'Tsani',
      akhir: 'Akhir'
    };

    // Dapatkan nama yang sesuai atau gunakan nilai default jika tidak ada
    const displayMember = memberNames[member] || member;
    const displayPrayer = prayerNames[prayer] || prayer;
    const displayType = typeNames[type] || type;

    // Format status text
    if (member && prayer && type) {
      if (statusText) {
        statusText.textContent = `sedang memutar i'lan ${displayType} ${displayPrayer} - ${displayMember}`;
        statusText.style.color = '#00c853'; // Hijau yang lebih kontras
      }
      if (playerStatus) {
        playerStatus.classList.add('playing');
        playerStatus.classList.remove('bell');
      }
    } else {
      // Jika audio sedang diputar tapi tidak ada info lengkap, tampilkan status default
      if (!player.paused) {
        if (statusText) {
          statusText.textContent = 'sedang memutar suara i\'lan';
          statusText.style.color = '#00c853'; // Hijau yang lebih kontras
        }
        if (playerStatus) {
          playerStatus.classList.add('playing');
          playerStatus.classList.remove('bell');
        }
      } else {
        if (statusText) {
          statusText.textContent = 'tidak memutar suara i\'lan';
          statusText.style.color = '#ff3333'; // Merah yang lebih kontras
        }
        if (playerStatus) {
          playerStatus.classList.remove('playing');
          playerStatus.classList.remove('bell');
        }
      }
    }
  }

  // Event listeners untuk audio dengan error handling yang lebih baik
  player.addEventListener('play', () => {
    try {
      const audioSrc = player.src;
      // Parse informasi dari nama file
      const match = audioSrc.match(/ilan\s+(subuh|dzuhur|ashar|magrib|isya|akhir)\s*(awal|tsani|akhir)?/i);
      
      if (match) {
        const prayerMap = {
          'subuh': 'fajr',
          'dzuhur': 'dhuhr',
          'ashar': 'asr',
          'magrib': 'maghrib',
          'isya': 'isha'
        };

        const prayer = prayerMap[match[1].toLowerCase()] || match[1];
        const type = (match[2] || 'akhir').toLowerCase();
        updateIlanStatus('alfatih', prayer, type);
      } else {
        // Jika tidak bisa parse info dari nama file, tampilkan status default
        updateIlanStatus();
      }
      logAudio('▶️ Audio mulai bermain');
    } catch (err) {
      console.error('Error in play handler:', err);
      updateIlanStatus();
    }
  });

  player.addEventListener('pause', () => {
    try {
      updateIlanStatus();
      logAudio('⏸️ Audio dipause');
    } catch (err) {
      console.error('Error in pause handler:', err);
    }
  });

  player.addEventListener('ended', () => {
    try {
      updateIlanStatus();
      logAudio('⏹️ Audio selesai');
    } catch (err) {
      console.error('Error in ended handler:', err);
    }
  });

  player.addEventListener('error', (e) => {
    try {
      const error = e.target.error;
      let errorMessage = 'Terjadi kesalahan saat memutar audio';
      
      if (error) {
        switch (error.code) {
          case error.MEDIA_ERR_ABORTED:
            errorMessage = 'Pemutaran audio dibatalkan';
            break;
          case error.MEDIA_ERR_NETWORK:
            errorMessage = 'Terjadi kesalahan jaringan';
            break;
          case error.MEDIA_ERR_DECODE:
            errorMessage = 'Format audio tidak didukung';
            break;
          case error.MEDIA_ERR_SRC_NOT_SUPPORTED:
            errorMessage = 'File audio tidak ditemukan atau tidak didukung';
            break;
        }
      }
      
      logAudio(`❌ ${errorMessage}`);
      updateIlanStatus();
    } catch (err) {
      console.error('Error in error handler:', err);
    }
  });

  // Manual controls
  document.getElementById('btnPlay').onclick = () => {
    const m = document.getElementById('member').value;
    const p = document.getElementById('prayer').value;
    const t = document.getElementById('type').value;
    if(!m||!p||!t) return alert("Pilih anggota, waktu, & jenis i'lan dulu!");
    playAudio(m,p,t);
  };
  
  document.getElementById('btnPause').onclick = () => player.pause();

  // Fungsi untuk update tabel jadwal
  function getCurrentPrayer() {
    if (!timings) return null;
    const now = new Date();
    
    // Konversi waktu sholat ke timestamp hari ini
    const prayerTimes = {
      fajr: convertToDate(timings.Fajr),
      sunrise: convertToDate(timings.Sunrise),
      dhuhr: convertToDate(timings.Dhuhr),
      asr: convertToDate(timings.Asr),
      maghrib: convertToDate(timings.Maghrib),
      isha: convertToDate(timings.Isha)
    };

    // Urutkan waktu sholat
    const orderedPrayers = Object.entries(prayerTimes).sort((a, b) => a[1] - b[1]);
    
    // Cari waktu sholat yang sedang berlangsung
    for (let i = orderedPrayers.length - 1; i >= 0; i--) {
      if (now >= orderedPrayers[i][1]) {
        // Khusus untuk subuh, cek apakah sudah terbit
        if (orderedPrayers[i][0] === 'fajr') {
          const sunriseTime = prayerTimes.sunrise;
          if (now >= sunriseTime) {
            return 'sunrise';
          }
        }
        // Tambahkan logika untuk sunrise saat dzuhur
        if (orderedPrayers[i][0] === 'dhuhr' || orderedPrayers[i][0] === 'asr' || 
            orderedPrayers[i][0] === 'maghrib' || orderedPrayers[i][0] === 'isha') {
          document.getElementById('time-sunrise').style.background = '#fff';
        }
        return orderedPrayers[i][0];
      }
    }
    
    // Jika sekarang sebelum subuh, cek apakah setelah isya hari sebelumnya
    const yesterdayIsha = new Date(now);
    yesterdayIsha.setDate(yesterdayIsha.getDate() - 1);
    const ishaTime = convertToDate(timings.Isha, yesterdayIsha);
    
    if (now >= ishaTime) {
      return 'isha';
    }
    
    // Jika tidak dalam kondisi apapun di atas, kembalikan waktu sholat terakhir
    return orderedPrayers[orderedPrayers.length - 1][0];
  }

  function updatePrayerTable() {
    if (!timings) return;
    
    document.getElementById('time-fajr').textContent = timings.Fajr;
    document.getElementById('time-sunrise').textContent = timings.Sunrise;
    document.getElementById('time-dhuhr').textContent = timings.Dhuhr;
    document.getElementById('time-asr').textContent = timings.Asr;
    document.getElementById('time-maghrib').textContent = timings.Maghrib;
    document.getElementById('time-isha').textContent = timings.Isha;

    // Reset warna sunrise ke default
    const now = new Date();
    const dhuhrTime = convertToDate(timings.Dhuhr);
    if (now < dhuhrTime) {
      document.getElementById('time-sunrise').style.background = '#ffe4b3';
    }

    // Reset semua highlight
    const timeElements = ['fajr', 'sunrise', 'dhuhr', 'asr', 'maghrib', 'isha'];
    timeElements.forEach(prayer => {
      const elementId = `time-${prayer}`;
      if (document.getElementById(elementId)) {
        document.getElementById(elementId).classList.remove('active');
      }
    });

    // Tandai waktu yang sedang berlangsung
    const currentPrayer = getCurrentPrayer();
    if (currentPrayer) {
      const elementId = `time-${currentPrayer}`;
      const element = document.getElementById(elementId);
      if (element) {
        element.classList.add('active');
      }
    }
  }

  // Update tabel setiap 30 detik untuk memastikan perpindahan tanda yang mulus
  setInterval(updatePrayerTable, 30000);

  // Fungsi untuk membersihkan log
  function clearLog() {
    const audioLog = document.getElementById('audio-log');
    const clearMessage = document.createElement('div');
    clearMessage.className = 'log-message success';
    clearMessage.innerHTML = '<span>✨ Log dibersihkan</span>';
    audioLog.innerHTML = '';
    audioLog.appendChild(clearMessage);
    setTimeout(() => {
      audioLog.innerHTML = '';
    }, 1000);
  }

  // Fungsi utilitas untuk konversi waktu
  function convertToDate(timeStr, baseDate = new Date()) {
    const [hours, minutes] = timeStr.split(':').map(Number);
    const date = new Date(baseDate);
    date.setHours(hours, minutes, 0, 0);
    return date;
  }

  async function playBell() {
    return new Promise((resolve, reject) => {
      try {
        const bellPlayer = new Audio('audio/ting tung ning nung.MP3');
        bellPlayer.volume = 1;

        // Update status untuk bell
        const statusText = document.querySelector('.status-text');
        const playerStatus = document.querySelector('.player-status');
        
        if (statusText) {
          statusText.textContent = 'memutar audio bell';
          statusText.style.color = '#ffb700';
        }
        if (playerStatus) {
          playerStatus.classList.remove('playing');
          playerStatus.classList.add('bell');
        }

        bellPlayer.onended = () => {
          // Reset status setelah bell selesai
          if (playerStatus) {
            playerStatus.classList.remove('bell');
          }
          if (statusText) {
            // Cek jika audio i'lan sedang diputar
            if (player.src && !player.paused) {
              statusText.textContent = 'sedang memutar suara i\'lan';
              statusText.style.color = '#00b300';
              playerStatus.classList.add('playing');
            } else {
              statusText.textContent = 'tidak memutar suara i\'lan';
              statusText.style.color = '#ff0000';
            }
          }
          resolve();
        };

        bellPlayer.onerror = (err) => {
          if (playerStatus) {
            playerStatus.classList.remove('bell');
          }
          if (statusText) {
            // Cek jika audio i'lan sedang diputar
            if (player.src && !player.paused) {
              statusText.textContent = 'sedang memutar suara i\'lan';
              statusText.style.color = '#00b300';
              playerStatus.classList.add('playing');
            } else {
              statusText.textContent = 'tidak memutar suara i\'lan';
              statusText.style.color = '#ff0000';
            }
          }
          reject(err);
        };

        bellPlayer.play();
      } catch (err) {
        const playerStatus = document.querySelector('.player-status');
        const statusText = document.querySelector('.status-text');
        
        if (playerStatus) {
          playerStatus.classList.remove('bell');
        }
        if (statusText) {
          // Cek jika audio i'lan sedang diputar
          if (player.src && !player.paused) {
            statusText.textContent = 'sedang memutar suara i\'lan';
            statusText.style.color = '#00b300';
            playerStatus.classList.add('playing');
          } else {
            statusText.textContent = 'tidak memutar suara i\'lan';
            statusText.style.color = '#ff0000';
          }
        }
        reject(err);
      }
    });
  }

  async function playAudio(member='alfatih', prayer='maghrib', type='tsani') {
    try {
      // Reset audio state
      if (player) {
        player.pause();
        player.currentTime = 0;
      }
      
      // Validasi parameter
      if (!member || !prayer || !type) {
        throw new Error('Parameter tidak lengkap');
      }

      // Update status sebelum mencoba memutar
      updateIlanStatus(member, prayer, type);

      // Tentukan nama file
      let fileName;
      if (member === 'alfatih') {
        if (type === 'akhir') {
          fileName = 'ilan akhir.MP3';
        } else {
          const prayerNames = {
            fajr: 'subuh',
            dhuhr: 'dzuhur',
            asr: 'ashar',
            maghrib: 'magrib',
            isha: 'isya'
          };
          
          if (!prayerNames[prayer]) {
            throw new Error(`Waktu sholat '${prayer}' tidak valid`);
          }
          
          fileName = `ilan ${prayerNames[prayer]} ${type}.MP3`;
        }
      } else {
        throw new Error(`Audio untuk ${member} belum tersedia`);
      }

      // Log file yang akan diputar
      logAudio(`📂 Mencari file: ${fileName}`);
      
      try {
        // Putar bell pertama
        logAudio('🔔 Memutar bell pembuka...');
        await playBell();
        
        // Set source untuk i'lan
        player.src = `audio/${fileName}`;
        player.controls = true;
        player.volume = 1;
        player.muted = false;

        // Putar i'lan
        const playPromise = player.play();
        if (playPromise !== undefined) {
          await playPromise;
          logAudio(`✅ Berhasil memutar i'lan ${type} ${prayer} - ${member}`);
          
          // Tunggu sampai i'lan selesai
          await new Promise((resolve) => {
            player.onended = resolve;
          });
          
          // Putar bell penutup
          logAudio('🔔 Memutar bell penutup...');
          await playBell();
          
          // Reset status setelah selesai
          const statusText = document.querySelector('.status-text');
          const playerStatus = document.querySelector('.player-status');
          if (statusText) {
            statusText.textContent = 'tidak memutar suara i\'lan';
            statusText.style.color = '#ff0000';
          }
          if (playerStatus) {
            playerStatus.classList.remove('playing');
            playerStatus.classList.remove('bell');
          }
          
          logAudio('✅ Selesai memutar seluruh rangkaian audio');
        }
      } catch (playError) {
        updateIlanStatus(); // Reset status jika gagal
        throw new Error(`Gagal memutar audio: ${playError.message}`);
      }
      
    } catch (err) {
      logAudio(`❌ Error: ${err.message}`);
      updateIlanStatus();
      
      if (err.name === 'NotAllowedError') {
        logAudio("⚠️ Browser memblokir autoplay. Coba klik player control secara manual.");
      } else if (err.name === 'NotFoundError' || err.message.includes('Failed to load')) {
        logAudio(`⚠️ File audio tidak ditemukan. Pastikan file ada di folder yang benar.`);
      }
    }
  }

  // Event listeners untuk audio dengan error handling
  player.addEventListener('loadstart', () => {
    try {
      logAudio('🎵 Audio mulai loading...');
    } catch (err) {
      console.error('Error in loadstart handler:', err);
    }
  });

  player.addEventListener('canplay', () => {
    try {
      logAudio('✅ Audio siap diputar');
    } catch (err) {
      console.error('Error in canplay handler:', err);
    }
  });

  player.addEventListener('playing', () => {
    try {
      document.querySelector('.player-status').classList.add('playing');
      logAudio('▶️ Audio mulai bermain');
    } catch (err) {
      console.error('Error in playing handler:', err);
    }
  });

  player.addEventListener('pause', () => {
    try {
      document.querySelector('.player-status').classList.remove('playing');
      logAudio('⏸️ Audio dipause');
      updateIlanStatus();
    } catch (err) {
      console.error('Error in pause handler:', err);
    }
  });

  player.addEventListener('ended', () => {
    try {
      document.querySelector('.player-status').classList.remove('playing');
      logAudio('⏹️ Audio selesai');
      updateIlanStatus();
    } catch (err) {
      console.error('Error in ended handler:', err);
    }
  });

  player.addEventListener('error', (e) => {
    try {
      const error = e.target.error;
      let errorMessage = 'Terjadi kesalahan saat memutar audio';
      
      if (error) {
        switch (error.code) {
          case error.MEDIA_ERR_ABORTED:
            errorMessage = 'Pemutaran audio dibatalkan';
            break;
          case error.MEDIA_ERR_NETWORK:
            errorMessage = 'Terjadi kesalahan jaringan';
            break;
          case error.MEDIA_ERR_DECODE:
            errorMessage = 'Format audio tidak didukung';
            break;
          case error.MEDIA_ERR_SRC_NOT_SUPPORTED:
            errorMessage = 'File audio tidak ditemukan atau tidak didukung';
            break;
        }
      }
      
      logAudio(`❌ ${errorMessage}`);
      updateIlanStatus();
    } catch (err) {
      console.error('Error in error handler:', err);
    }
  });

  // Manual controls
  document.getElementById('btnPlay').onclick = () => {
    const m = document.getElementById('member').value;
    const p = document.getElementById('prayer').value;
    const t = document.getElementById('type').value;
    if(!m||!p||!t) return alert("Pilih anggota, waktu, & jenis i'lan dulu!");
    playAudio(m,p,t);
  };
  
  document.getElementById('btnPause').onclick = () => player.pause();

  // Fungsi untuk update tabel jadwal
  function getCurrentPrayer() {
    if (!timings) return null;
    const now = new Date();
    
    // Konversi waktu sholat ke timestamp hari ini
    const prayerTimes = {
      fajr: convertToDate(timings.Fajr),
      sunrise: convertToDate(timings.Sunrise),
      dhuhr: convertToDate(timings.Dhuhr),
      asr: convertToDate(timings.Asr),
      maghrib: convertToDate(timings.Maghrib),
      isha: convertToDate(timings.Isha)
    };

    // Urutkan waktu sholat
    const orderedPrayers = Object.entries(prayerTimes).sort((a, b) => a[1] - b[1]);
    
    // Cari waktu sholat yang sedang berlangsung
    for (let i = orderedPrayers.length - 1; i >= 0; i--) {
      if (now >= orderedPrayers[i][1]) {
        // Khusus untuk subuh, cek apakah sudah terbit
        if (orderedPrayers[i][0] === 'fajr') {
          const sunriseTime = prayerTimes.sunrise;
          if (now >= sunriseTime) {
            return 'sunrise';
          }
        }
        // Tambahkan logika untuk sunrise saat dzuhur
        if (orderedPrayers[i][0] === 'dhuhr' || orderedPrayers[i][0] === 'asr' || 
            orderedPrayers[i][0] === 'maghrib' || orderedPrayers[i][0] === 'isha') {
          document.getElementById('time-sunrise').style.background = '#fff';
        }
        return orderedPrayers[i][0];
      }
    }
    
    // Jika sekarang sebelum subuh, cek apakah setelah isya hari sebelumnya
    const yesterdayIsha = new Date(now);
    yesterdayIsha.setDate(yesterdayIsha.getDate() - 1);
    const ishaTime = convertToDate(timings.Isha, yesterdayIsha);
    
    if (now >= ishaTime) {
      return 'isha';
    }
    
    // Jika tidak dalam kondisi apapun di atas, kembalikan waktu sholat terakhir
    return orderedPrayers[orderedPrayers.length - 1][0];
  }

  function updatePrayerTable() {
    if (!timings) return;
    
    document.getElementById('time-fajr').textContent = timings.Fajr;
    document.getElementById('time-sunrise').textContent = timings.Sunrise;
    document.getElementById('time-dhuhr').textContent = timings.Dhuhr;
    document.getElementById('time-asr').textContent = timings.Asr;
    document.getElementById('time-maghrib').textContent = timings.Maghrib;
    document.getElementById('time-isha').textContent = timings.Isha;

    // Reset warna sunrise ke default
    const now = new Date();
    const dhuhrTime = convertToDate(timings.Dhuhr);
    if (now < dhuhrTime) {
      document.getElementById('time-sunrise').style.background = '#ffe4b3';
    }

    // Reset semua highlight
    const timeElements = ['fajr', 'sunrise', 'dhuhr', 'asr', 'maghrib', 'isha'];
    timeElements.forEach(prayer => {
      const elementId = `time-${prayer}`;
      if (document.getElementById(elementId)) {
        document.getElementById(elementId).classList.remove('active');
      }
    });

    // Tandai waktu yang sedang berlangsung
    const currentPrayer = getCurrentPrayer();
    if (currentPrayer) {
      const elementId = `time-${currentPrayer}`;
      const element = document.getElementById(elementId);
      if (element) {
        element.classList.add('active');
      }
    }
  }

  // Update tabel setiap 30 detik untuk memastikan perpindahan tanda yang mulus
  setInterval(updatePrayerTable, 30000);

  // Fungsi untuk membersihkan log
  function clearLog() {
    const audioLog = document.getElementById('audio-log');
    const clearMessage = document.createElement('div');
    clearMessage.className = 'log-message success';
    clearMessage.innerHTML = '<span>✨ Log dibersihkan</span>';
    audioLog.innerHTML = '';
    audioLog.appendChild(clearMessage);
    setTimeout(() => {
      audioLog.innerHTML = '';
    }, 1000);
  }

  // Fungsi utilitas untuk konversi waktu
  function convertToDate(timeStr, baseDate = new Date()) {
    const [hours, minutes] = timeStr.split(':').map(Number);
    const date = new Date(baseDate);
    date.setHours(hours, minutes, 0, 0);
    return date;
  }
</script>

  <div class="footer">
    <div class="footer-content">
      <img src="logo_bapen.svg" alt="Logo BAPEN" class="footer-logo">
      <div class="footer-text">&copy; Language of Education ISPAH 2025</div>
    </div>
  </div>

</body>
</html>
